<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Escape Game ‚Äî Entr√©e secr√®te</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#8b5cf6;--muted:#9aa4b2;--glass:rgba(255,255,255,0.04)}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;color:#e6eef6;background:radial-gradient(1200px 600px at 10% 10%, rgba(139,92,246,0.12), transparent), radial-gradient(900px 500px at 90% 90%, rgba(14,165,233,0.06), transparent), var(--bg);}
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:2rem}
    .card{width:100%;max-width:520px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);backdrop-filter:blur(6px);padding:2rem;border-radius:16px;box-shadow:0 10px 30px rgba(2,6,23,0.6)}
    h1{margin:0 0 .25rem;font-size:1.5rem}
    p.lead{margin:0 0 1.25rem;color:var(--muted)}
    .input-row{display:flex;gap:.75rem;align-items:center}
    .field{flex:1;position:relative}
    input[type=text]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit;font-size:1rem;outline:none;transition:box-shadow .15s, transform .06s}
    input[type=text]:focus{box-shadow:0 6px 20px rgba(139,92,246,0.12);transform:translateY(-1px)}
    button.btn{padding:12px 18px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent),#06b6d4);color:white;font-weight:600;cursor:pointer;box-shadow:0 8px 20px rgba(11,17,38,0.6);transition:transform .12s}
    button.btn:active{transform:translateY(1px)}
    .status{margin-top:1rem;min-height:1.25rem;color:var(--muted)}
    .status.good{color:#86efac}
    .status.bad{color:#ffb4b4}
    .meta{margin-top:1rem;font-size:.85rem;color:var(--muted);display:flex;justify-content:space-between;align-items:center}
    .hint{font-style:italic}
    .footer{margin-top:1.25rem;text-align:center;color:var(--muted);font-size:.83rem}
    @media (max-width:520px){.card{padding:1.25rem}}
  </style>
</head>
<body>
  <div class="wrap">
    <section class="card" aria-labelledby="title">
      <header>
        <h1 id="title">Portail secret</h1>
        <p class="lead">
          Mon premier n'est pas vrai.<br>
          Mon second est le contraire de tard.<br>
          Mon troisi√®me qualifie la nourriture des fast-foods.<br>
          Mon quatri√®me me r√©chauffe en hiver.<br>
          Mon tout √©tait pr√©sent sur chaque sc√®ne de crime.
        </p>
      </header>

      <div class="input-row" role="group" aria-label="Champ mot de passe">
        <div class="field">
          <label for="pass" class="sr-only" style="display:none">Mot de passe</label>
          <input id="pass" type="text" inputmode="text" autocomplete="off" placeholder="Entrez le mot de passe" aria-describedby="status" />
        </div>
        <button id="submit" class="btn" aria-live="polite">Valider</button>
      </div>

      <div id="status" class="status" role="status" aria-atomic="true"></div>

      <div class="meta">
        <div class="hint">Essais restants : <span id="tries">5</span></div>
        <div id="lockinfo"></div>
      </div>
    </section>
  </div>

  <script>
    const SECRET_URL = 'audio.html'; 
    const SECRET_HASH = '30447e01802591f9dde78c113920e29478b265fc6685d557825942b86adf6229';
    const MAX_TRIES = 5;
    const LOCK_SECONDS = 30; 

    let triesLeft = MAX_TRIES;
    let lockedUntil = 0;

    const pass = document.getElementById('pass');
    const submit = document.getElementById('submit');
    const status = document.getElementById('status');
    const triesEl = document.getElementById('tries');
    const lockinfo = document.getElementById('lockinfo');

    triesEl.textContent = triesLeft;

    submit.addEventListener('click', tryPassword);
    pass.addEventListener('keydown', (e) => { if (e.key === 'Enter') tryPassword(); });

    async function tryPassword(){
      if (Date.now() < lockedUntil) return;
      const val = pass.value || '';
      if (!val){ showStatus('Entrez un mot de passe.', false); return; }

      showStatus('V√©rification‚Ä¶', null);
      const h = await computeHash(val);

      if (h === SECRET_HASH){
        showStatus('‚úÖ Mot de passe correct ‚Äî redirection‚Ä¶', true);
        setTimeout(() => { window.location.href = SECRET_URL; }, 700);
        return;
      }

      triesLeft -= 1;
      triesEl.textContent = triesLeft;
      if (triesLeft <= 0){
        lockedUntil = Date.now() + LOCK_SECONDS * 1000;
        showStatus(`üîí Trop d'√©checs ‚Äî verrouillage pendant ${LOCK_SECONDS} secondes.`, false);
        lockCountdown();
      } else {
        showStatus(`‚ùå Mot de passe incorrect ‚Äî ${triesLeft} essais restants.`, false);
      }
    }

    function showStatus(msg, ok){
      status.textContent = msg;
      status.classList.remove('good','bad');
      if (ok === true) status.classList.add('good');
      if (ok === false) status.classList.add('bad');
    }

    function lockCountdown(){
      const interval = setInterval(()=>{
        const remaining = Math.max(0, Math.ceil((lockedUntil - Date.now())/1000));
        if (remaining <= 0){
          clearInterval(interval);
          triesLeft = MAX_TRIES;
          triesEl.textContent = triesLeft;
          lockinfo.textContent = '';
          showStatus('Vous pouvez r√©essayer.', null);
          return;
        }
        lockinfo.textContent = `Verrouill√© : ${remaining}s`;
      }, 250);
    }

    async function computeHash(text){
      const enc = new TextEncoder().encode(text);
      const buf = await crypto.subtle.digest('SHA-256', enc);
      return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
    }
  </script>
</body>
</html>
