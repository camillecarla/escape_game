<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Escape Game — Identité du tueur</title>
  <style>
    :root{--bg:#071026;--card:#0b1220;--accent:#ef4444;--muted:#9aa4b2;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;color:#eaf2ff;background:radial-gradient(800px 400px at 10% 20%, rgba(239,68,68,0.06), transparent), linear-gradient(180deg,#061124 0%, #071026 100%);}
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:2rem}
    .card{width:100%;max-width:720px;padding:2rem;border-radius:14px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.05);box-shadow:0 12px 40px rgba(2,6,23,0.6)}
    h1{margin:0 0 .25rem;font-size:1.5rem}
    p.lead{margin:0 0 1rem;color:var(--muted)}
    .banner{display:flex;align-items:center;gap:.75rem;padding:12px;border-radius:10px;background:linear-gradient(90deg, rgba(239,68,68,0.12), rgba(245,158,11,0.06));border:1px solid rgba(239,68,68,0.14);color:#ffeef0;margin-bottom:1rem}
    .banner strong{color:#ffdede}
    .row{display:flex;gap:.75rem;align-items:center}
    input[type=text]{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.1);background:var(--glass);color:inherit;font-size:1rem}
    button.btn{padding:12px 16px;border-radius:10px;border:0;background:linear-gradient(90deg,#ef4444,#f97316);color:white;font-weight:700;cursor:pointer}
    .status{margin-top:1rem;min-height:1.25rem;color:var(--muted)}
    .status.bad{color:#ffb4b4}
    .status.good{color:#86efac}
    .meta{margin-top:1rem;color:var(--muted);display:flex;justify-content:space-between}
    .full-screen{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.85);backdrop-filter:blur(2px);color:white;z-index:60}
    .full-screen[hidden]{display:none!important}
    .full-screen h2{font-size:3rem;margin:0}
    .muted-small{font-size:.85rem;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <section class="card" aria-labelledby="title">
      <div class="banner" role="alert">
        <div>⚠️</div>
        <div>
          <div><strong>Attention :</strong> votre localisation sera envoyée au tueur en cas de trop nombreux échecs.</div>
        </div>
      </div>

      <header>
        <h1 id="title">Qui est le tueur ?</h1>
        <p class="lead">Indiquez le nom du serial killer d'après les indices.</p>
      </header>

      <div class="row">
        <input id="answer" type="text" placeholder="Nom du tueur" autocomplete="off" />
        <button id="submit" class="btn">Valider</button>
      </div>

      <div id="status" class="status"></div>

      <div class="meta">
        <div>Essais restants : <strong id="tries">4</strong></div>
        <div class="muted-small">Vous êtes si près du but...</div>
      </div>
    </section>
  </div>

  <div id="overlay" class="full-screen" hidden>
    <div style="text-align:center;max-width:900px;padding:1rem">
      <h2 id="overlay-title">GAME OVER</h2>
      <p id="overlay-msg" style="font-size:1.15rem;margin-top:.5rem"></p>
      <div style="margin-top:1rem; display:flex; gap:1rem; justify-content:center;">
          <button id="restart" class="btn">Recommencer</button>
          <button id="win" class="btn" hidden>Voir la récompense</button>
      </div>
    </div>
  </div>

  <script>
    const SECRET_HASH = 'b6bc7b606eeb25b8e0d52d151392c29ba49e621adcbd321c1601786c27c7d03d';
    const MAX_TRIES = 4;
    const LOCK_DURATION = 10;

    let triesLeft = MAX_TRIES;
    let lockUntil = 0;

    const answerEl = document.getElementById('answer');
    const submit = document.getElementById('submit');
    const status = document.getElementById('status');
    const triesEl = document.getElementById('tries');
    const overlay = document.getElementById('overlay');
    const overlayTitle = document.getElementById('overlay-title');
    const overlayMsg = document.getElementById('overlay-msg');
    const restart = document.getElementById('restart');
    const win = document.getElementById('win');
      
    submit.addEventListener('click', onSubmit);
    answerEl.addEventListener('keydown', e => { if (e.key === 'Enter') onSubmit(); });
    restart.addEventListener('click', resetGame);
    win.addEventListener('click', seeReward);

    function showStatus(msg, ok) {
      status.textContent = msg;
      status.className = 'status' + (ok === true ? ' good' : ok === false ? ' bad' : '');
    }

    async function onSubmit() {
      if (Date.now() < lockUntil) {
        showStatus('Verrouillage en cours…', false);
        return;
      }

      const val = answerEl.value.trim().toLowerCase();
      if (!val) return showStatus('Entrez un nom.', false);

      showStatus('Vérification...', null);
      const h = await computeHash(val);

      if (h === SECRET_HASH) {
        showStatus('✅ Bonne réponse !', true);
        setTimeout(() => {
          overlayTitle.textContent = 'FÉLICITATIONS';
          overlayMsg.textContent = 'Vous avez trouvé l’identité du tueur.';
          restart.hidden = true;
          win.hidden = false;
          overlay.hidden = false;
        }, 500);
        return;
      }

      triesLeft--;
      triesEl.textContent = triesLeft;
      if (triesLeft <= 0) {
        showStatus('Trop d’erreurs…', false);
        lockUntil = Date.now() + LOCK_DURATION * 1000;
        dramatizeLockSequence();
      } else {
        showStatus(`❌ Mauvaise réponse (${triesLeft} essais restants)`, false);
      }
    }

    function dramatizeLockSequence() {
      overlayTitle.textContent = 'LE TUEUR EST EN ROUTE';
      overlay.hidden = false;
      restart.hidden = true;
      let remaining = LOCK_DURATION;
      const timer = setInterval(() => {
        remaining--;
        overlayMsg.innerHTML = `${remaining}s restantes<br><span class="muted-small"></span>`;
        if (remaining <= 0) {
          clearInterval(timer);
          overlayTitle.textContent = 'VOUS ÊTES MORTES';
          overlayMsg.innerHTML = '<strong>Le tueur est arrivé.</strong><br><span class="muted-small">Fin de la partie</span>';
          restart.hidden = false;
a        }
      }, 1000);
    }

    function resetGame() {
      triesLeft = MAX_TRIES;
      triesEl.textContent = triesLeft;
      answerEl.value = '';
      overlay.hidden = true;
      restart.hidden = false;
      win.hidden = true;
      showStatus('Nouvelle partie.', null);
    }

    function seeReward() {
      window.location.href = "aveux.html"; 
    }

    async function computeHash(text) {
      const enc = new TextEncoder().encode(text);
      const buf = await crypto.subtle.digest('SHA-256', enc);
      return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2, '0')).join('');
    }
  </script>
</body>
</html>
